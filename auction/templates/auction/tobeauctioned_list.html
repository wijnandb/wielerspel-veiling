{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% block css %}
    <link rel="stylesheet" href="{% static 'css/sort-list.css' %}">
{% endblock %}
{% block content %}
    <div>
        <h1>Geheime lijst van {{ user }}</h1>
        <p>Dit zijn de renners die {{ user.first_name }} wil aanbieden. </p>
        <p>Volgorde van aanbieden kan gewijzigd worden door de renner te slepen naar de gewenste positie.</p>
    </div>
    <div class="col-md-12">
            <table width="100%" border="0" class="table thead-dark">
                <thead class="thead-dark">
                    <tr>
                        <th class="text-center">positie</th>
                        <!--th>vorige</th-->
                        <th>renner</th>
                        <th class="text-center">ploeg</th>
                        <th class="text-center">nationaliteit</th>
                        <th class="text-center">leeftijd</th>
                        <th class="text-center">beginbod</th>
                    </tr>
                </thead>
                <tbody id="sortlist">
                    {% for renner in renners %}
                        <tr id={{ renner.rider.pk }} data-lookup="{{ renner.id }}">
                            <td class="text-center">{{ renner.rider.rank }}</td>
                            <!--td>({{ renner.rider.prev }})</td-->
                            <td>{{ renner.rider }}</td>
                            <td class="text-center">{{ renner.rider.team }}</td>
                            <td class="text-center">{{ renner.rider.nationality }}</td>
                            <td class="text-center">{{ renner.rider.age }}</td>
                            <td class="text-center">{{ renner.amount }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <form id="orderingForm" method="post" action="{% url 'auction:ajax-save-ordering-tobeauctioned' %}">
                {% csrf_token %}
                <input type="hidden" id="orderingInput" name="ordering">
            </form>
    </div>
    <div class="col-md-12 text-center">
        <br/><br/><button id="saveOrdering" class="btn btn-outline-primary btn-lg mr-2">Volgorde opslaan</button><br/><br/><br/>
    </div>
{% endblock %}
{% block js %}
<script src="{% static 'js/sort-list.js' %}"></script>
<script>
    window.addEventListener("DOMContentLoaded", function(){
      slist("sortlist");
    });

    const saveOrderingButton = document.getElementById('saveOrdering');
    const orderingForm = document.getElementById('orderingForm');
    const formInput = orderingForm.querySelector('#orderingInput');

    saveOrderingButton.addEventListener('click', saveOrdering);

    function saveOrdering() {
        const rows = document.getElementById("sortlist").querySelectorAll('tr');
        let ids = [];
        for (let row of rows) {
            ids.push(row.dataset.lookup);
        }
        //alert(ids);
        formInput.value = ids.join(',');
        orderingForm.submit();
    }
</script>
{% endblock %}

